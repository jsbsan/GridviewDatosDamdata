' Gambas class file

Public formularioPrincipal As Object

Public Sub TextAreaSCRIPT_KeyPress()

End

Public Sub ButtonEjecutar_Click()

  Dim COMANDO As String[]
  Dim TOKEN As String[]
  Dim C As String

  'ejecutar
  comando = Split(TextAreaSCRIPT.text, "\n")

  For Each c In comando
    token = Split(c, ",")
    If token.count = 2 Then
      ejecutar(token[0], token[1])
    Endif
    If token.count = 1 Then
      'orden de operar
      ejecutar(token[0], "")
    Endif

  Next

  Settings["scriptAnterior"] = TextAreaSCRIPT.text

End

Public Sub ejecutar(lugar As String, valor As String)

  lugar = Upper(LUGAR)
  Select Case lugar
    Case Upper("TextBoxColumnaSENSOR")
      formularioPrincipal.TextBoxColumnaSENSOR.text = valor

    Case Upper("TextBoxColumnaDatos")
      formularioPrincipal.TextBoxColumnaDatos.text = valor

    Case Upper("CheckButtonhora")
      formularioPrincipal.CheckButtonhora.Value = If(Mid$(Upper(valor), 1, 1) = "T", True, False)

    Case Upper("CheckBoxCabecera")
      formularioPrincipal.CheckBoxCabecera.Value = If(Mid$(Upper(valor), 1, 1) = "T", True, False)

    Case Upper("TextBoxHora")
      If valor = "" Then valor = "08:00:00"
      formularioPrincipal.TextBoxHora.text = valor

    Case Upper("ButtonOperar_click()")
      formularioPrincipal.ButtonOperar_Click()
      Wait 5'espero unos segundos despues de realizar calculos

  End Select

End

Public Sub Form_Open()

  Settings.Read(Me)

End

Public Sub ButtonRecuperarScript_Click()

  TextAreaSCRIPT.Text = settings["scriptAnterior", ""]

End

Public Sub ButtonReiniciarContenido_Click()

  TextAreaSCRIPT.Text = ButtonReiniciarContenido.tag

End

Public Sub Form_Close()

  Settings.Write(Me)

End

Public Sub ButtonGenerarScript_Click()

  Dim GridViewDATOS As GridView
  Dim A As Integer

  GridViewDATOS = formularioPrincipal.GridViewOrigen
  'la 1ยบ columna tiene fecha

  'empiezo en la 2ยบ columna
  TextAreaSCRIPT.Text = ""
  For a = 1 To (GridViewDATOS.Columns.Count - 1) Step 2
    TextAreaSCRIPT.Text &= "------------" & "\n"
    TextAreaSCRIPT.Text &= "TextBoxColumnaSENSOR," & GridViewDATOS[1, a].text & "\n"
    TextAreaSCRIPT.Text &= "TextBoxColumnaDatos," & Str(A + 2) & "\n"
    TextAreaSCRIPT.Text &= "CheckButtonhora," & If(CheckBoxHORA.VALUE, "T", "F") & "\n"
    TextAreaSCRIPT.Text &= "CheckBoxCabecera," & If(CheckBoxcABECERA.VALUE, "T", "F") & "\n"
    TextAreaSCRIPT.Text &= "TextBoxHora," & "\n"
    TextAreaSCRIPT.Text &= "ButtonOperar_click()" & "\n"
  Next

End
